---
- name: Install Go language and docs
  ansible.builtin.dnf:
    state: present
    name:
      - golang
      - golang-docs
  become: true

- name: Check Go version
  ansible.builtin.command: go version
  register: result
  changed_when: false
  ignore_errors: true

- name: Install a handful of Go packages
  ansible.builtin.command: "go install {{ item }}"
  environment:
    GOPATH: "/home/{{ user }}/workspace/golang"
    GOBIN: "/home/{{ user }}/workspace/golang/bin"
  register: go_install_result
  changed_when: >
    go_install_result.stderr is search("Downloading")
    or go_install_result.stderr is search("linking")
  loop:
    - github.com/doronbehar/pistol/cmd/pistol@latest
    - github.com/remotemobprogramming/mob/v5@latest
    - github.com/vishen/go-chromecast@latest
