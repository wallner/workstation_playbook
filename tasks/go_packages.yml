---
# Go language installation and package management

- name: Install Go language and docs
  ansible.builtin.dnf:
    state: present
    name:
      - golang
      - golang-docs
  become: true

- name: Check Go version
  ansible.builtin.command: go version
  register: result
  changed_when: false
  ignore_errors: true

- name: Install Go packages
  ansible.builtin.command: "go install {{ item }}"
  environment:
    GOPATH: "/home/{{ user }}/workspace/golang"
    GOBIN: "/home/{{ user }}/workspace/golang/bin"
  register: go_install_result
  changed_when: >
    go_install_result.stderr is search("Downloading")
    or go_install_result.stderr is search("linking")
  loop: "{{ packages_go }}"
